# If not running interactively, don't do anything (leave this at the top of this file)
[[ $- != *i* ]] && return

{{/* Omarchy specific */}}
{{- if lookPath "omarchy-version" }}
# Omarchy defaults
source ~/.local/share/omarchy/default/bash/rc
{{- end }}

{{/* If not on Omarchy */}}
{{- if not (lookPath "omarchy-version") }}
export PATH="$HOME/.local/bin:$PATH"

alias ..='cd ..'
alias ...='cd ../..'
if [[ "${OSTYPE:-}" != "msys" ]]; then
  alias ls='eza -lh --group-directories-first --icons=auto'
  alias lt='eza --tree --level=2 --long --icons --git'

fi
alias lsa='ls -a'
alias lta='lt -a'
alias g='git'
alias gcm='git cm'
alias doc='lazydocker'

{{- if lookPath "starship" }}
# Starship prompt
eval "$(starship init bash)"
{{- end }}

{{- if lookPath "batcat" }}
alias cat=batcat
{{- end}}

{{/* end non Omarchy: */}}
{{- end }}

{{/* Homebrew */}}
{{- if or (lookPath "brew") (stat "/home/linuxbrew/.linuxbrew/bin/brew") }}
# Homebrew
export HOMEBREW_NO_ENV_HINTS=1
eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
{{- end }}


# Aliases
alias dot=chezmoi
alias bup="dot apply && source ~/.bashrc"
alias s='jq ".scripts" package.json'
alias p='pnpm'
alias rmr='rm -rf --one-file-system --preserve-root'
alias galias="git config --get-regexp '^alias\.'"
alias gtree='git ls-files | tree --fromfile'
alias cc='cursor . 2>/dev/null'

{{/* yazi */}}
{{- if lookPath "yazi" }}
function y() {
	local tmp="$(mktemp -t "yazi-cwd.XXXXXX")" cwd
	yazi "$@" --cwd-file="$tmp"
	IFS= read -r -d '' cwd < "$tmp"
	[ -n "$cwd" ] && [ "$cwd" != "$PWD" ] && builtin cd -- "$cwd"
	rm -f -- "$tmp"
}
{{- end }}

mcd() {
  mkdir -p "$1" && cd "$1"
}

newapp() {
  if [[ -z "$1" ]]; then
    echo "Usage: newapp <app-name>"
    return 1
  fi

  local app_name="$1"
  if pnpx create-react-router@latest "$app_name" \
    --git-init \
    --install \
    --package-manager pnpm \
    --yes \
    --template stianthaulow/rr-template \
    --show-install-output false \
    >/dev/null
  then
    cd "$app_name"
  else
    echo "create-react-router failed" >&2
    return 1
  fi
}

# Edit bash profile
ep() {
  local file="$HOME/.bashrc"

  # Open source state, then apply to target when editor exits
  chezmoi edit --apply "$file" || return

  # Re-source only if we're in an interactive shell
  if [[ $- == *i* ]]; then
    # shellcheck source=/dev/null
    . "$file"
    echo "Reloaded $file"
  fi
}

{{- if lookPath "npm" }}
# npm global path
export PATH="$HOME/.npm-global/bin:$PATH"
{{- end }}

{{/* Fast Node Manager */}}
{{- if or (lookPath "fnm") (stat (joinPath .chezmoi.homeDir ".local" "share" "fnm")) }}
export FNM_MULTISHELL_PATH="$HOME/.cache/fnm_multishells"
mkdir -p "$FNM_MULTISHELL_PATH"
FNM_PATH="$HOME/.local/share/fnm"
export PATH="$FNM_PATH:$PATH"
eval "$(fnm env --use-on-cd --shell bash)"
{{- end }}

{{/* Mise */}}
{{- if lookPath "mise" }}
eval "$(mise activate bash)"
{{- end }}

{{/* tobi/try */}}
{{- if stat (joinPath .chezmoi.homeDir ".local" "try.rb") }}
export TRY_PATH=~/lab
eval "$(ruby ~/.local/try.rb init $TRY_PATH)"
{{- end }}


# Bookmarks
source ~/.config/bash/bookmarks/b


# Load user-specific bash completions
if [ -d ~/.config/bash/completion.d ]; then
  for f in ~/.config/bash/completion.d/*; do
    [ -r "$f" ] && source "$f"
  done
fi


{{- if lookPath "adb" }}
# Android sdk
export ANDROID_SDK_ROOT=/opt/android-sdk
export PATH=$PATH:$ANDROID_SDK_ROOT/emulator:$ANDROID_SDK_ROOT/platform-tools:$ANDROID_SDK_ROOT/cmdline-tools/latest/bin
{{- end }}

{{/* pnpm */}}
{{- if or (lookPath "pnpm") (stat (joinPath .chezmoi.homeDir ".local" "share" "pnpm")) }}
export PNPM_HOME="$HOME/.local/share/pnpm"
case ":$PATH:" in
  *":$PNPM_HOME:"*) ;;
  *) export PATH="$PNPM_HOME:$PATH" ;;
esac
{{- end }}

{{- if lookPath "uv" }}
# uv
export PATH="/home/stian/.local/bin:$PATH"
{{- end }}


{{/* Rust (cargo) */}}
{{- if lookPath "rustc" }}
export CARGO_HOME="$HOME/.cargo"
case ":$PATH:" in
  *":$CARGO_HOME/bin:"*) ;;
  *) export PATH="$CARGO_HOME/bin:$PATH" ;;
esac
{{- end }}

# bun
{{- if or (lookPath "bun") (stat (joinPath .chezmoi.homeDir ".bun")) }}
export BUN_INSTALL="$HOME/.bun"
case ":$PATH:" in
  *":$BUN_INSTALL/bin:"*) ;;
  *) export PATH="$BUN_INSTALL/bin:$PATH" ;;
esac
{{- end }}

{{/* Zoxide config if not on omarchy, where it is enabled already */}}
{{- if and (lookPath "zoxide") (not (lookPath "omarchy-version")) }}
eval "$(zoxide init bash)"
{{- end }}
